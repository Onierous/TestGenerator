<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>DJ Landing-Page Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
  </head>

  <body>
    <main class="container">
      <h1>DJ Landing-Page Generator</h1>

      <form x-data="pageMaker()" @submit.prevent="generate()">
        <label>Name
          <input x-model="dj.name" required>
        </label>

        <label>Tagline
          <input x-model="dj.tagline" required>
        </label>

        <label>Profile picture
          <input type="file" @change="uploadPic">
        </label>

        <label>SoundCloud URL (track or playlist)
          <input x-model="dj.soundcloud" placeholder="https://soundcloud.com/...">
        </label>

        <button>Generate page</button>
      </form>

      <article x-show="previewUrl">
        <h2>Preview / Download</h2>
        <iframe :src="previewUrl" width="100%" height="400"></iframe>
        <br>
        <a class="button" :href="downloadUrl" download="index.html">Download index.html</a>
      </article>
    </main>

    <!-- Alpine -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js"></script>

    <script>
      function pageMaker() {
        return {
          dj: { name:'', tagline:'', pic:'', soundcloud:'' },
          previewUrl: null,
          downloadUrl: null,

          async uploadPic(e) {
            const file = e.target.files[0];
            const fd = new FormData();
            fd.append('file', file);
            fd.append('upload_preset', 'unsigned'); // change to your Cloudinary preset
            const res = await fetch('https://api.cloudinary.com/v1_1/daafwau38/image/upload', {method:'POST', body:fd});
            const json = await res.json();
            this.dj.pic = json.secure_url;
          },

          generate() {
            const html = this.renderPage();
            const blob = new Blob([html], {type:'text/html'});
            this.previewUrl = URL.createObjectURL(blob);
            this.downloadUrl = this.previewUrl;
          },

          renderPage() {
            const {name, tagline, pic, soundcloud} = this.dj;
            return `
<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>${name}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <style>body{text-align:center;max-width:600px;margin:auto;padding:2rem}</style>
  </head>
  <body>
    <header>
      <h1>${name}</h1>
      <p>${tagline}</p>
    </header>

    ${pic ? `<img src="${pic}" style="width:200px;border-radius:50%">` : ''}

    ${soundcloud ? `
      <iframe width="100%" height="166" scrolling="no" frameborder="no"
        src="https://w.soundcloud.com/player/?url=${encodeURIComponent(soundcloud)}&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false">
      </iframe>
    ` : ''}
  </body>
</html>`;
          }
        };
      }
    </script>
  </body>
</html>
